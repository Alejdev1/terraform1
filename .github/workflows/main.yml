name: terraform-localstack
run-name: Terraform Localstack Testing
on: [push]
jobs:
  terraform-localstack-configuration:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Install Terraform
      run: |
        wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
        echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
        sudo apt-get update && sudo apt-get install terraform
    - name: Install LocalStack CLI and tflocal
      run: |
        pip install localstack-client
        pip install terraform-local
    - name: Start LocalStack
      run: |
        localstack start --docker
    - name: Terraform Plan
      run: |
        tflocal init
    - name: Terraform Apply
      run: |
        tflocal validate
